import 'dart:io';

import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'package:gap/gap.dart';
import 'package:hart_suite/style/style_base.dart';
import 'package:hart_suite/widgets/form/text_view.dart';

class CameraCaptureConfirmation extends StatefulWidget {
  static const route = '/cameraCaptureConfirmation';
  const CameraCaptureConfirmation({
    super.key,
    required this.image,
  });

  final XFile image;

  @override
  State<CameraCaptureConfirmation> createState() => CameraCaptureConfirmationState();
}

class CameraCaptureConfirmationState extends State<CameraCaptureConfirmation> {
  late String fileName, originalFileName;
  late TextView imageName;

  @override
  void initState() {
    super.initState();

    originalFileName = widget.image.path.split('/').last;

    fileName = originalFileName.substring(0, originalFileName.lastIndexOf('.'));

    imageName = TextView(
      label: 'Name',
      text: fileName,
      decoration: StyleBase.getInputDecoration(),
      autoFocus: true,
    );

    imageName.dataBind(callback: () {
      fileName = imageName.controller!.text;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SingleChildScrollView(
        child: Column(
          children: [
            Stack(
              alignment: Alignment.bottomCenter,
              children: [
                Image.file(
                  frameBuilder: (context, child, frame, wasSynchronouslyLoaded) {
                    if (frame != null) {
                      return child;
                    } else {
                      return const SizedBox(
                        height: 500,
                        // added to retain size while frame is drawn
                      );
                    }
                  },
                  File(widget.image.path),
                  filterQuality: FilterQuality.medium,
                ),
                Padding(
                  padding: const EdgeInsets.only(bottom: 8.0),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.center,
                    crossAxisAlignment: CrossAxisAlignment.end,
                    children: [
                      ElevatedButton(
                        onPressed: () {
                          Navigator.pop(context);
                        },
                        child: const Text('Cancel'),
                      ),
                      const Gap(16),
                      ElevatedButton(
                        onPressed: () {
                          Navigator.pop(
                            context,
                            [widget.image, fileName],
                          );
                        },
                        child: const Text('Save'),
                      ),
                    ],
                  ),
                ),
              ],
            ),
            Padding(
              padding: const EdgeInsets.all(8.0),
              child: imageName.child,
            ),
          ],
        ),
      ),
    );
  }
}
