import 'package:flutter/material.dart';
import 'package:hart_suite/models/attachment/attachment.dart';
import 'package:hart_suite/models/general/auditable.dart';
import 'package:hart_suite/models/profile/person_snapshot.dart';
import 'package:hart_suite/style/style_base.dart';
import 'package:hart_suite/widgets/form/text_view.dart';

class OnlineAttachment extends StatefulWidget {
  const OnlineAttachment({super.key, required this.personSnapshot});

  final PersonSnapshot personSnapshot;

  @override
  State<OnlineAttachment> createState() => _OnlineAttachmentState();
}

class _OnlineAttachmentState extends State<OnlineAttachment> {
  late Attachment attachment;
  late TextView link, name;

  @override
  void initState() {
    super.initState();

    attachment = Attachment(
      fileName: '',
      fileLocation: '',
    );

    name = TextView(
      label: 'Name',
      decoration: StyleBase.getInputDecoration(),
      text: attachment.fileName,
    );

    name.dataBind(callback: () => attachment.fileName = name.controller!.text);

    link = TextView(
      label: 'Link',
      decoration: StyleBase.getInputDecoration(),
      text: attachment.fileLocation,
    );

    link.dataBind(callback: () => attachment.fileLocation = link.controller!.text);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Online Attachment'),
        actions: [
          IconButton(
            icon: const Icon(Icons.check),
            onPressed: () {
              Auditable created = Auditable(person: widget.personSnapshot, dateStamp: DateTime.now());

              attachment.created = created;
              attachment.fileName = name.controller!.text;
              attachment.fileLocation = link.controller!.text;
              attachment.documentId = attachment.fileName;
              attachment.isOnline = true;

              if (attachment.fileLocation.startsWith('www.')) {
                attachment.fileLocation = 'https://${attachment.fileLocation}';
              }

              Navigator.pop(context, attachment);
            },
          ),
        ],
      ),
      body: Padding(
        padding: const EdgeInsets.all(8.0),
        child: SingleChildScrollView(
          child: Column(
            children: [
              name.child,
              SizedBox(height: 10),
              link.child,
            ],
          ),
        ),
      ),
    );
  }
}
