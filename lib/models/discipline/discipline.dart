import 'package:hart_suite/models/general/auditable.dart';
import 'package:hart_suite/models/general/filter.dart';

class Discipline {
  String? documentId;
  String name;
  String iconCode;
  Auditable? created;
  Auditable? updated;
  Auditable? deleted;

  Discipline({this.documentId, required this.name, required this.iconCode, this.created, this.updated, this.deleted});

  Filter toFilter() {
    return Filter(id: '', name: name, iconCode: iconCode, semanticLabel: name);
  }

  Map<String, dynamic> toMap() {
    return {
      'documentId': documentId,
      'name': name,
      'iconCode': iconCode,
      'created': created?.toMap(),
      'updated': updated?.toMap(),
      'deleted': deleted?.toMap()
    };
  }

  static Discipline? fromMap(Map<String, dynamic>? map) {
    Discipline? discipline;

    if (map == null || map.isEmpty || map['documentId'] == null) {
      discipline = null;
    } else {
      discipline = Discipline(
        documentId: map.containsKey('documentId') ? map['documentId'] : null,
        name: map.containsKey('name') ? map['name'] : null,
        iconCode: map.containsKey('iconCode') ? map['iconCode'] : 'branding_watermark',
        created: map.containsKey('created') ? Auditable.fromMap(map['created']) : null,
        updated: map.containsKey('updated') ? Auditable.fromMap(map['updated']) : null,
        deleted: map.containsKey('deleted') ? Auditable.fromMap(map['deleted']) : null,
      );
    }

    return discipline;
  }

  static Map<String, Discipline?> populate(Map<String, dynamic> map) {
    Map<String, Discipline?> disciplines;

    disciplines = <String, Discipline?>{};

    for (var key in map.keys) {
      disciplines[key] = Discipline.fromMap(map[key]);
    }

    return disciplines;
  }
}
