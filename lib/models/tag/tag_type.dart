import 'package:hart_suite/models/general/auditable.dart';

class TagType {
  String documentId;
  String name;
  Auditable? created;
  Auditable? updated;
  Auditable? deleted;

  TagType({required this.documentId, required this.name, this.created, this.updated, this.deleted});

  Map<String, dynamic> toMap() {
    return {'documentId': documentId, 'name': name, 'created': created?.toMap(), 'updated': updated?.toMap(), 'deleted': deleted?.toMap()};
  }

  static TagType? fromMap(Map<String, dynamic>? map) {
    TagType? tagType;

    if (map == null || map.isEmpty || map['documentId'] == null) {
      tagType = null;
    } else {
      tagType = TagType(
        documentId: map.containsKey('documentId') ? map['documentId'] : null,
        name: map.containsKey('name') ? map['name'] : '',
        created: map.containsKey('created') ? Auditable.fromMap(map['created']) : null,
        updated: map.containsKey('updated') ? Auditable.fromMap(map['updated']) : null,
        deleted: map.containsKey('deleted') ? Auditable.fromMap(map['deleted']) : null,
      );
    }

    return tagType;
  }

  static Map<String, TagType?> populate(Map<String, dynamic> map) {
    Map<String, TagType?> innerMap;

    innerMap = <String, TagType?>{};

    for (var key in map.keys) {
      innerMap[key] = TagType.fromMap(map[key]);
    }

    return innerMap;
  }
}
