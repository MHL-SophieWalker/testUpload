import 'package:hart_suite/models/actions/subcategory.dart';
import 'package:hart_suite/models/general/auditable.dart';

class Category {
  String? documentId;
  String name;
  late String nameLower;
  Map<String, SubCategory>? subCategories;
  String customer;
  Auditable? created;
  Auditable? updated;
  Auditable? deleted;

  Category({this.documentId, required this.name, required this.subCategories, required this.customer, this.created, this.updated, this.deleted}) {
    nameLower = name.toLowerCase();
  }

  static Category? fromMap(Map<String, dynamic>? map) {
    Category? category;
    Map<String, SubCategory> subCategories = {};

    if (map == null || map.isEmpty || map['documentId'] == null) {
      category = null;
    } else {
      if (map.containsKey('subCategories') && map['subCategories'] != null) {
        for (var key in map['subCategories'].keys) {
          subCategories[key] = SubCategory.fromMap(map['subCategories'][key])!;
        }
      }

      category = Category(
          documentId: map.containsKey('documentId') ? map['documentId'] : null,
          name: map.containsKey('name') ? map['name'] : '',
          subCategories: subCategories,
          customer: map.containsKey('customer') ? map['customer'] : '',
          created: map.containsKey('created') ? Auditable.fromMap(map['created']) : null,
          updated: map.containsKey('updated') ? Auditable.fromMap(map['updated']) : null,
          deleted: map.containsKey('deleted') ? Auditable.fromMap(map['deleted']) : null);
    }

    return category;
  }

  Map<String, dynamic> toMap() {
    return {
      'documentId': documentId,
      'name': name,
      'nameLower': name.toLowerCase(),
      'subCategories': subCategories?.map((key, value) => MapEntry(key, value.toMap())) ?? {},
      'customer': customer,
      'created': created?.toMap(),
      'updated': updated?.toMap(),
      'deleted': deleted?.toMap()
    };
  }
}
