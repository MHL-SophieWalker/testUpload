import 'package:hart_suite/models/general/auditable.dart';

class SubCategory {
  String? documentId;
  String name;
  late String nameLower;
  String? categoryId;
  String categoryName;
  String customer;
  late String categoryNameLower;
  late String path;
  late String pathLower;
  Auditable? created;
  Auditable? updated;
  Auditable? deleted;

  SubCategory(
      {this.documentId,
      required this.name,
      required this.categoryId,
      required this.categoryName,
      required this.customer,
      this.created,
      this.updated,
      this.deleted}) {
    nameLower = name.toLowerCase();
    categoryNameLower = categoryName.toLowerCase();
    path = '$categoryName - $name';
    pathLower = path.toLowerCase();
  }

  static SubCategory? fromMap(Map<String, dynamic>? map) {
    SubCategory? subCategory;

    if (map == null || map.isEmpty || map['documentId'] == null) {
      subCategory = null;
    } else {
      subCategory = SubCategory(
          documentId: map.containsKey('documentId') ? map['documentId'] : null,
          name: map.containsKey('name') ? map['name'] : '',
          categoryId: map.containsKey('categoryId') ? map['categoryId'] : '',
          categoryName: map.containsKey('categoryName') ? map['categoryName'] : '',
          customer: map.containsKey('customer') ? map['customer'] : '',
          created: map.containsKey('created') ? Auditable.fromMap(map['created']) : null,
          updated: map.containsKey('updated') ? Auditable.fromMap(map['updated']) : null,
          deleted: map.containsKey('deleted') ? Auditable.fromMap(map['deleted']) : null);
    }

    return subCategory;
  }

  Map<String, dynamic> toMap() {
    return {
      'documentId': documentId,
      'name': name,
      'nameLower': name.toLowerCase(),
      'categoryId': categoryId,
      'categoryName': categoryName,
      'customer': customer,
      'categoryNameLower': categoryName.toLowerCase(),
      'created': created?.toMap(),
      'updated': updated?.toMap(),
      'deleted': deleted?.toMap()
    };
  }
}
