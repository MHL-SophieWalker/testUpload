import 'package:hart_suite/models/profile/person_snapshot.dart';

class Position {
  String jobTitle = '';
  String department = '';
  String company = '';
  String division = '';
  PersonSnapshot? manager;

  Position({required this.jobTitle, required this.department, required this.company, required this.division, this.manager});

  Map<String, dynamic> toMap() {
    return {
      'jobTitle': jobTitle,
      'department': department,
      'company': company,
      'division': division,
      'manager': manager?.toMap(),
    };
  }

  static Position? fromMap(Map<String, dynamic>? map) {
    Position? position;

    if (map == null || map.isEmpty) {
      position = Position(jobTitle: '', department: '', company: '', division: '');
    } else {
      position = Position(
        jobTitle: map.containsKey('jobTitle') ? map['jobTitle'] : '',
        department: map.containsKey('department') ? map['department'] : '',
        company: map.containsKey('company') ? map['company'] : '',
        division: map.containsKey('division') ? map['division'] : '',
        manager: map.containsKey('manager') ? PersonSnapshot.fromMap(map['manager']) : null,
      );
    }

    return position;
  }

  static Map<String, Position?> populate(Map<String, dynamic> map) {
    Map<String, Position?> innerMap;

    innerMap = <String, Position?>{};

    for (var key in map.keys) {
      innerMap[key] = Position.fromMap(map[key]);
    }

    return innerMap;
  }
}
