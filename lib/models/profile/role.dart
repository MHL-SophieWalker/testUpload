import 'package:hart_suite/models/general/auditable.dart';

class Role {
  String? documentId;
  String name;
  Auditable? created;
  Auditable? updated;
  Auditable? deleted;

  Role({this.documentId, required this.name, this.created, this.updated, this.deleted});

  Map<String, dynamic> toMap() {
    return {'documentId': documentId, 'name': name, 'created': created?.toMap(), 'updated': updated?.toMap(), 'deleted': deleted?.toMap()};
  }

  static Role? fromMap(Map<String, dynamic>? map) {
    Role? role;

    if (map == null || map.isEmpty || map['documentId'] == null) {
      role = null;
    } else {
      role = Role(
        documentId: map.containsKey('documentId') ? map['documentId'] : null,
        name: map.containsKey('name') ? map['name'] : '',
        created: map.containsKey('created') ? Auditable.fromMap(map['created']) : null,
        updated: map.containsKey('updated') ? Auditable.fromMap(map['updated']) : null,
        deleted: map.containsKey('deleted') ? Auditable.fromMap(map['deleted']) : null,
      );
    }

    return role;
  }

  static Map<String, Role?> populate(Map<String, dynamic> map) {
    Map<String, Role?> innerMap;

    innerMap = <String, Role?>{};

    for (var key in map.keys) {
      innerMap[key] = Role.fromMap(map[key]);
    }

    return innerMap;
  }
}
