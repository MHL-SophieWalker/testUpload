class App {
  String? documentId;
  String name;

  App({this.documentId, required this.name});

  Map<String, dynamic> toMap() {
    return {'documentId': documentId, 'name': name};
  }

  static App? fromMap(Map<String, dynamic>? map) {
    App? app;

    if (map == null || map.isEmpty || map['documentId'] == null) {
      app = null;
    } else {
      app = App(
        documentId: map.containsKey('documentId') ? map['documentId'] : null,
        name: map.containsKey('name') ? map['name'] : '',
      );
    }

    return app;
  }

  static Map<String, App?> populate(Map<String, dynamic> map) {
    Map<String, App?> innerMap;

    innerMap = <String, App?>{};

    for (var key in map.keys) {
      innerMap[key] = App.fromMap(map[key]);
    }

    return innerMap;
  }
}
