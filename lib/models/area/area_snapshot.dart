class AreaSnapshot {
  String? documentId;
  String name;
  String description;
  String path;
  late String nameLower;

  AreaSnapshot({this.documentId, required this.name, required this.description, required this.path}) {
    nameLower = name.toLowerCase();
  }

  Map<String, dynamic> toMap() {
    return {'documentId': documentId, 'name': name, 'description': description, 'nameLower': name.toLowerCase(), 'path': path};
  }

  static AreaSnapshot? fromMap(Map<String, dynamic>? map) {
    AreaSnapshot? area;

    if (map == null || map.isEmpty || map['documentId'] == null) {
      area = null;
    } else {
      area = AreaSnapshot(
        documentId: map.containsKey('documentId') ? map['documentId'] : null,
        name: map.containsKey('name') ? map['name'] : '',
        description: map.containsKey('description') ? map['description'] : '',
        path: map.containsKey('path') ? map['path'] : '',
      );
    }

    return area;
  }
}
