class Coords {
  double lat;
  double long;

  Coords({required this.lat, required this.long});

  Map<String, dynamic> toMap() {
    return {'lat': lat, 'long': long};
  }

  static Coords? fromMap(Map<String, dynamic>? map) {
    Coords? coords;

    if (map == null || map.isEmpty) {
      coords = null;
    } else {
      coords = Coords(
        lat: map.containsKey('lat') ? map['lat'] : 0,
        long: map.containsKey('long') ? map['long'] : 0,
      );
    }

    return coords;
  }

  static Map<String, Coords?> populate(Map<String, dynamic> map) {
    Map<String, Coords?> innerMap;

    innerMap = <String, Coords?>{};

    for (var key in map.keys) {
      innerMap[key] = Coords.fromMap(map[key]);
    }

    return innerMap;
  }
}
