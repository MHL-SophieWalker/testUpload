import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:hart_suite/models/profile/person_snapshot.dart';

class Auditable {
  PersonSnapshot? person;
  DateTime? dateStamp;
  String? note;

  Auditable({required this.person, required this.dateStamp, this.note});

  Map<String, dynamic> toMap() {
    return {'person': person!.toMap(), 'dateStamp': dateStamp, 'note': note};
  }

  static Auditable? fromMap(Map<String, dynamic>? map) {
    Auditable? audit;

    if (map == null || map.isEmpty || map['person'] == null) {
      audit = null;
    } else {
      audit = Auditable(
          person: map.containsKey('person') ? PersonSnapshot.fromMap(map['person']) : null,
          dateStamp: map.containsKey('dateStamp') ? (map['dateStamp'] as Timestamp).toDate() : null,
          note: map.containsKey('note') ? map['note'] : null);
    }

    return audit;
  }

  static Map<String, Auditable?> populate(Map<String, dynamic> map) {
    Map<String, Auditable?> innerMap;

    innerMap = <String, Auditable?>{};

    for (var key in map.keys) {
      innerMap[key] = Auditable.fromMap(map[key]);
    }

    return innerMap;
  }
}
