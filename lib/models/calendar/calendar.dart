import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:hart_suite/models/general/auditable.dart';

class Calendar {
  String? documentId;
  String name;
  String description;
  Auditable? created;
  Auditable? updated;
  Auditable? deleted;
  List<DateTime>? datePoints;

  Calendar({required this.documentId, required this.name, required this.description, this.created, this.updated, this.deleted, required this.datePoints});

  Map<String, dynamic> toMap() {
    return {
      'documentId': documentId,
      'name': name,
      'description': description,
      'created': created?.toMap(),
      'updated': updated?.toMap(),
      'deleted': deleted?.toMap(),
      'datePoints': datePoints
    };
  }

  static Calendar? fromMap(Map<String, dynamic>? map) {
    Calendar? calendar;
    List<DateTime> datePoints;

    datePoints = List.empty(growable: true);

    if (map == null || map.isEmpty || map['documentId'] == null) {
      calendar = null;
    } else {
      if (map.containsKey('datePoints')) {
        for (var date in map['datePoints']) {
          datePoints.add((date as Timestamp).toDate());
        }
      }

      calendar = Calendar(
          documentId: map.containsKey('documentId') ? map['documentId'] : null,
          name: map.containsKey('name') ? map['name'] : '',
          description: map.containsKey('description') ? map['description'] : '',
          created: map.containsKey('created') ? Auditable.fromMap(map['created']) : null,
          updated: map.containsKey('updated') ? Auditable.fromMap(map['updated']) : null,
          deleted: map.containsKey('deleted') ? Auditable.fromMap(map['deleted']) : null,
          datePoints: datePoints);
    }

    return calendar;
  }

  static Map<String, Calendar?> populate(Map<String, dynamic> map) {
    Map<String, Calendar?> innerMap;

    innerMap = <String, Calendar?>{};

    for (var key in map.keys) {
      innerMap[key] = Calendar.fromMap(map[key]);
    }

    return innerMap;
  }
}
