import 'package:firebase_storage/firebase_storage.dart';
import 'package:flutter/material.dart';
import 'package:hart_suite/error_handler.dart';

class FileUpload extends StatefulWidget {
  final UploadTask? task;
  final Function successCallback, errorCallback;
  final double widthOffset;

  const FileUpload({super.key, required this.task, required this.successCallback, required this.errorCallback, required this.widthOffset});

  @override
  State<FileUpload> createState() => _FileUploadState();
}

class _FileUploadState extends State<FileUpload> {
  late double progress, newProgress, width;

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();

    width = MediaQuery.of(context).size.width - widget.widthOffset - 100;
    progress = 0.0;
    newProgress = 0.0;
  }

  @override
  Widget build(BuildContext context) {
    widget.task?.snapshotEvents.listen((TaskSnapshot taskSnapshot) {
      switch (taskSnapshot.state) {
        case TaskState.running:
          newProgress = 100.0 * (taskSnapshot.bytesTransferred / taskSnapshot.totalBytes);

          if (newProgress != progress && mounted) {
            setState(() {
              progress = newProgress;
            });
          }

          ErrorHandler.log("Upload is $progress% complete.");
          break;
        case TaskState.paused:
          ErrorHandler.log("Upload is paused.");
          break;
        case TaskState.canceled:
          ErrorHandler.log("Upload was canceled");
          break;
        case TaskState.error:
          widget.errorCallback();
          break;
        case TaskState.success:
          widget.successCallback(name: taskSnapshot.ref.name, path: taskSnapshot.ref.fullPath);
          break;
      }
    });

    return Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        SizedBox(
          width: width,
          child: LinearProgressIndicator(
            value: progress > 0 ? progress / 100 : 0,
          ),
        ),
      ],
    );
  }
}
