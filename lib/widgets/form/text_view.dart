import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:hart_suite/style/style_base.dart';

class TextView {
  late Widget child;
  final String label;
  late TextEditingController? controller;
  late InputDecoration inputDecoration;
  late Function(String value)? onSubmitted;
  final bool readOnly;

  TextView({
    required this.label,
    required InputDecoration decoration,
    required String text,
    TextInputType inputType = TextInputType.text,
    int maxLines = 1,
    int minLines = 1,
    bool autoFocus = false,
    this.onSubmitted,
    this.readOnly = false,
    bool enabled = true,
    int? maxLength,
    bool required = false,
    this.controller,
    bool isLauncher = false,
  }) {
    controller ??= TextEditingController();
    TextField textField;
    Widget lbl;

    if (required) {
      lbl = Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Text(label),
          const Text(
            '*',
            style: TextStyle(color: Colors.red),
          ),
        ],
      );
    } else {
      lbl = Text(label);
    }

    controller!.text = text;

    inputDecoration = decoration.copyWith(
      label: lbl,
      suffixIcon: isLauncher
          ? const Icon(
              Icons.launch,
              color: StyleBase.grey,
            )
          : null,
    );

    textField = TextField(
      decoration: inputDecoration,
      controller: controller,
      onSubmitted: onSubmitted,
      maxLines: maxLines,
      minLines: minLines,
      autofocus: autoFocus,
      readOnly: readOnly,
      enabled: enabled,
      maxLength: maxLength,
      maxLengthEnforcement: MaxLengthEnforcement.enforced,
    );

    child = textField;
  }

  dataBind({required Function callback}) {
    controller!.addListener(() {
      callback();
    });
  }
}
