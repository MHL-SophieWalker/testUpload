import 'package:flutter/material.dart';
import 'package:hart_suite/models/profile/person.dart';
import 'package:hart_suite/widgets/profile/profile_card.dart';

class ProfileCardWithActions extends StatelessWidget {
  const ProfileCardWithActions({
    super.key,
    required this.user,
    required this.buttons,
  });

  final Person user;
  final List<Widget> buttons;

  @override
  Widget build(BuildContext context) {
    return Card(
      color: Theme.of(context).cardColor,
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Expanded(
            child: Padding(
              padding: const EdgeInsets.only(left: 8.0),
              child: ProfileCard(
                person: user,
                showItems: [ProfileCard.showJobTitle],
              ).profileCard,
            ),
          ),
          Padding(
            padding: const EdgeInsets.only(right: 8.0),
            child: Align(
              alignment: Alignment.centerRight,
              child: Row(
                children: buttons,
              ),
            ),
          ),
        ],
      ),
    );
  }
}
