import 'package:flutter/material.dart';
import 'package:hart_suite/error_handler.dart';
import 'package:hart_suite/style/style_base.dart';
import 'package:package_info_plus/package_info_plus.dart';

class AppVersionInfo extends StatefulWidget {
  final bool expanded;

  const AppVersionInfo({super.key, required this.expanded});

  @override
  State<AppVersionInfo> createState() => _AppVersionInfoState();
}

class _AppVersionInfoState extends State<AppVersionInfo> {
  late Future<PackageInfo> futureVersion;
  late PackageInfo package;

  @override
  Widget build(BuildContext context) {
    Widget defaultPlaceholder = const SizedBox(height: 18);

    futureVersion = PackageInfo.fromPlatform();

    return FutureBuilder(
      future: futureVersion,
      builder: (BuildContext context, AsyncSnapshot<PackageInfo?> snapshot) {
        if (snapshot.connectionState == ConnectionState.done) {
          if (snapshot.hasData) {
            package = snapshot.data!;

            return widget.expanded
                ? Padding(
                    padding: const EdgeInsets.fromLTRB(12, 0, 0, 4),
                    child: Text(
                      'Version: ${package.version}',
                      overflow: TextOverflow.ellipsis,
                      style: const TextStyle(fontSize: 10, color: StyleBase.grey),
                    ),
                  )
                : defaultPlaceholder;
          } else if (snapshot.hasError) {
            ErrorHandler.logError(exception: snapshot.error);

            return defaultPlaceholder;
          } else {
            return defaultPlaceholder;
          }
        } else {
          return defaultPlaceholder;
        }
      },
    );
  }
}
