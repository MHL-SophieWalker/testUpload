import 'package:intl/intl.dart';

class DateHelp {
  static String formatDateOnly(DateTime date) {
    String dat;

    DateFormat formatter = DateFormat('yyyy-MM-dd');

    dat = formatter.format(date);

    return dat;
  }

  static String formatDateOnlyFriendly(DateTime date) {
    String dat;

    DateFormat formatter = DateFormat('dd-MMM-yyyy');

    dat = formatter.format(date);

    return dat;
  }

  static String formatDateTime(DateTime date) {
    String dat;

    DateFormat formatter = DateFormat('yyyy-MM-dd HH:mm:ss');

    dat = formatter.format(date);

    return dat;
  }

  static String formatDateTimeNoSeconds(DateTime date) {
    String dat;

    DateFormat formatter = DateFormat('yyyy-MM-dd HH:mm');

    dat = formatter.format(date);

    return dat;
  }

  static String formatISODateTime(DateTime date) {
    String dat;

    DateFormat formatter = DateFormat('yyyy-MM-ddTHH:mm:ss');

    dat = formatter.format(date);

    return dat;
  }

  static String formatYearMonth(DateTime date) {
    String dat;

    DateFormat formatter = DateFormat('yyyy-MM');

    dat = formatter.format(date);

    return dat;
  }

  static bool validate({required String value, required String format}) {
    bool valid = false;

    try {
      DateFormat formatter = DateFormat(format);
      formatter.parseStrict(value);
      valid = true;
    } catch (e) {
      valid = false;
    }

    return valid;
  }

  static DateTime? getDateFromString({required String date, required String format}) {
    DateTime? dateTime;

    if (validate(value: date, format: format)) {
      DateFormat formatter = DateFormat(format);

      dateTime = formatter.parse(date);
    }

    return dateTime;
  }
}
